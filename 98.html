<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í¬ì¼“ëª¬ ê²€ìƒ‰ê¸°</title>
    <style>
      @font-face {
        font-family: "Simple";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2307-1@1.1/Danjo-bold-Regular.woff2")
          format("woff2");
        font-weight: normal;
        font-display: swap;
      }

      body,
      input {
        font-family: "Simple";
      }

      /* section */
      section {
        margin: 1rem 2rem;
      }

      /* controller */
      #search-form {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
        align-items: center;
      }

      #search-form * {
        width: 240px;
        margin: 0;
        padding: 0.3rem;
        border: 1px solid grey;
        border-radius: 0.3rem;
      }

      /* ëœë¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
      #random-btn {
        background-color: #ffcb05;
        color: #3d7dca;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      #random-btn:hover {
        background-color: #3d7dca;
        color: #ffcb05;
        transform: scale(1.05);
      }

      #search-form-btn {
        background-color: #3d7dca;
        color: white;
        cursor: pointer;
      }

      #search-form-btn:hover {
        background-color: #2c5aa0;
      }

      /* container */
      #container,
      #poke-info > section {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
        align-items: center;
      }

      /* í¬ì¼“ëª¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
      #poke-info {
        background: linear-gradient(145deg, #f0f0f0, #ffffff);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        max-width: 300px;
        margin: 0 auto;
      }

      #poke-info img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: radial-gradient(circle, #ffffff, #f0f0f0);
        padding: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .poke-name {
        font-size: 1.2em;
        margin: 0.2rem 0;
      }

      #message {
        font-size: 1.1em;
        color: #666;
        text-align: center;
        padding: 20px;
      }

      .hide {
        display: none;
      }

      /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
      .loading {
        color: #3d7dca;
        font-weight: bold;
      }

      .loading::after {
        content: "";
        animation: dots 1.5s infinite;
      }

      @keyframes dots {
        0% {
          content: "";
        }
        25% {
          content: ".";
        }
        50% {
          content: "..";
        }
        75% {
          content: "...";
        }
        100% {
          content: "";
        }
      }
    </style>
  </head>
  <body>
    <section id="controller">
      <form id="search-form">
        <input
          type="text"
          name="poke-name"
          id="poke-name"
          placeholder="í¬ì¼“ëª¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
        />
        <button type="submit" id="search-form-btn">ê²€ìƒ‰</button>
        <button type="button" id="random-btn">ğŸ² ëœë¤ í¬ì¼“ëª¬</button>
      </form>
    </section>

    <section id="container">
      <div id="message">ê²€ìƒ‰í•˜ê±°ë‚˜ ëœë¤ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</div>
      <section class="hide" id="poke-info">
        <section>
          <div class="poke-name">
            <strong>ì´ë¦„</strong>: <span id="poke-koname">í¬ì¼“ëª¬</span>
          </div>
          <div class="poke-name">
            <strong>ì˜ì–´</strong>: <span id="poke-enname">Pokemon</span>
          </div>
          <img src="" alt="í¬ì¼“ëª¬ ì‚¬ì§„" />
        </section>
      </section>
    </section>

    <script>
      // í¬ì¼“ëª¬ IDë¥¼ ì €ì¥í•  ë³€ìˆ˜
      let nameToIdData = {};

      async function changeNameToId(name) {
        // ì´ë¯¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
        if (Object.keys(nameToIdData).length > 0) {
          return nameToIdData[name];
        }

        // ê°„ë‹¨í™”: ì²˜ìŒ 151ê°œë§Œ ë¡œë“œ (ì„±ëŠ¥ ê°œì„ )
        const pokeLength = 152; // 1~151

        try {
          const promises = [];
          for (let i = 1; i < pokeLength; i++) {
            promises.push(fetchPokeKor(i));
          }
          await Promise.all(promises);
          return nameToIdData[name];
        } catch (error) {
          console.error("í¬ì¼“ëª¬ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", error);
          return null;
        }
      }

      async function fetchPokeKor(id) {
        const response = await fetch(
          `https://pokeapi.co/api/v2/pokemon-species/${id}`
        );
        if (!response.ok) return;

        const data = await response.json();
        const koNames = data.names.filter((x) => x.language.name === "ko");
        if (koNames.length > 0) {
          nameToIdData[koNames[0].name] = id;
        }
      }

      async function searchPoke(event) {
        event.preventDefault();

        const name = document.querySelector("#poke-name").value.trim();
        if (!name) {
          alert("í¬ì¼“ëª¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        showLoading();
        await searchName(name);
      }

      async function searchRandomPoke() {
        showLoading();
        // 1~151 ì¤‘ ëœë¤ ì„ íƒ
        const randomId = Math.floor(Math.random() * 151) + 1;
        await searchById(randomId);
      }

      async function searchName(name) {
        try {
          const pokeId = await changeNameToId(name);
          if (!pokeId) {
            showMessage("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í¬ì¼“ëª¬ì…ë‹ˆë‹¤!");
            return;
          }
          await searchById(pokeId);
        } catch (error) {
          showMessage("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!");
          console.error(error);
        }
      }

      async function searchById(pokeId) {
        try {
          // í¬ì¼“ëª¬ ê¸°ë³¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const response = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${pokeId}`
          );
          if (!response.ok)
            throw new Error("í¬ì¼“ëª¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");

          const data = await response.json();

          // í•œê¸€ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
          const speciesResponse = await fetch(
            `https://pokeapi.co/api/v2/pokemon-species/${pokeId}`
          );
          const speciesData = await speciesResponse.json();

          const koNames = speciesData.names.filter(
            (x) => x.language.name === "ko"
          );
          const koName = koNames.length > 0 ? koNames[0].name : data.name;

          // UI ì—…ë°ì´íŠ¸
          document.querySelector("#container img").src =
            data.sprites.front_default;
          document.querySelector("#poke-koname").textContent = koName;
          document.querySelector("#poke-enname").textContent = data.name;

          // ê²€ìƒ‰ì°½ì—ë„ í•œê¸€ ì´ë¦„ í‘œì‹œ
          document.querySelector("#poke-name").value = koName;

          // ê²°ê³¼ í‘œì‹œ
          document.querySelector("#poke-info").classList.remove("hide");
          document.querySelector("#message").classList.add("hide");
        } catch (error) {
          showMessage("í¬ì¼“ëª¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!");
          console.error(error);
        }
      }

      function showLoading() {
        document.querySelector("#message").textContent =
          "í¬ì¼“ëª¬ì„ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤";
        document.querySelector("#message").className = "loading";
        document.querySelector("#poke-info").classList.add("hide");
        document.querySelector("#message").classList.remove("hide");
      }

      function showMessage(text) {
        document.querySelector("#message").textContent = text;
        document.querySelector("#message").className = "";
        document.querySelector("#poke-info").classList.add("hide");
        document.querySelector("#message").classList.remove("hide");
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      document
        .querySelector("#search-form")
        .addEventListener("submit", searchPoke);
      document
        .querySelector("#random-btn")
        .addEventListener("click", searchRandomPoke);

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ëœë¤ í¬ì¼“ëª¬ í•˜ë‚˜ í‘œì‹œ
      document.addEventListener("DOMContentLoaded", async () => {
        await searchRandomPoke();
      });
    </script>
  </body>
</html>
